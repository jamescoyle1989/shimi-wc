import{T as f}from"./lit-element-b97bcfb0.js";import{f as g}from"./directive-helpers-51f6ee5d.js";import{d as u}from"./index-894feb9a.js";/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const p={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},$=i=>(...e)=>({_$litDirective$:i,values:e});class v{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,s){this._$Ct=e,this._$AM=t,this._$Ci=s}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const h=(i,e)=>{var s;const t=i._$AN;if(t===void 0)return!1;for(const o of t)(s=o._$AO)==null||s.call(o,e,!1),h(o,e);return!0},l=i=>{let e,t;do{if((e=i._$AM)===void 0)break;t=e._$AN,t.delete(i),i=e}while((t==null?void 0:t.size)===0)},N=i=>{for(let e;e=i._$AM;i=e){let t=e._$AN;if(t===void 0)e._$AN=t=new Set;else if(t.has(i))break;t.add(i),E(e)}};function M(i){this._$AN!==void 0?(l(this),this._$AM=i,N(this)):this._$AM=i}function A(i,e=!1,t=0){const s=this._$AH,o=this._$AN;if(o!==void 0&&o.size!==0)if(e)if(Array.isArray(s))for(let d=t;d<s.length;d++)h(s[d],!1),l(s[d]);else s!=null&&(h(s,!1),l(s));else h(this,i)}const E=i=>{i.type==p.CHILD&&(i._$AP??(i._$AP=A),i._$AQ??(i._$AQ=M))};class m extends v{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,t,s){super._$AT(e,t,s),N(this),this.isConnected=e._$AU}_$AO(e,t=!0){var s,o;e!==this.isConnected&&(this.isConnected=e,e?(s=this.reconnected)==null||s.call(this):(o=this.disconnected)==null||o.call(this)),t&&(h(this,e),l(this))}setValue(e){if(g(this._$Ct))this._$Ct._$AI(e,this);else{const t=[...this._$Ct._$AH];t[this._$Ci]=e,this._$Ct._$AI(t,this,0)}}disconnected(){}reconnected(){}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const G=()=>new w;class w{}const _=new WeakMap,U=$(class extends m{render(i){return f}update(i,[e]){var s;const t=e!==this.G;return t&&this.G!==void 0&&this.ot(void 0),(t||this.rt!==this.lt)&&(this.G=e,this.ct=(s=i.options)==null?void 0:s.host,this.ot(this.lt=i.element)),f}ot(i){if(typeof this.G=="function"){const e=this.ct??globalThis;let t=_.get(e);t===void 0&&(t=new WeakMap,_.set(e,t)),t.get(this.G)!==void 0&&this.G.call(this.ct,void 0),t.set(this.G,i),i!==void 0&&this.G.call(this.ct,i)}else this.G.value=i}get rt(){var i,e;return typeof this.G=="function"?(i=_.get(this.ct??globalThis))==null?void 0:i.get(this.G):(e=this.G)==null?void 0:e.value}disconnected(){this.rt===this.lt&&this.ot(void 0)}reconnected(){this.ot(this.lt)}}),n={none:0,noteCreation:1,noteStart:2,noteEnd:4,pitch:8};class B{constructor(e,t){this._dragMode=n.none,this._dragOffset=0,this._clipEditor=e,this._viewModel=t}onMouseDown(e,t){const s=this._viewModel;if(!s.clip)return;const o=s.getBeatFromX(e.x),d=s.getPitchFromY(e.y),r=s.getNoteAt(o,d);t==1&&r?this._removeNote(r):t==0&&(r?this._beginNoteDrag(r,o):this._addNewNote(o,d))}onDoubleClick(e){this.onMouseDown(e,1)}onMouseMove(e){const t=this._viewModel;if(!t.selectedNote||this._dragMode==n.none)return;const s=(this._dragMode&n.noteCreation)>0,o=(this._dragMode&n.noteStart)>0,d=(this._dragMode&n.noteEnd)>0,r=(this._dragMode&n.pitch)>0,c=t.getSnappedBeat(t.getBeatFromX(e.x)-this._dragOffset);if(o&&d)t.selectedNote.start=c;else if(o){if(c<t.selectedNote.end){const a=t.selectedNote.end;t.selectedNote.start=c,t.selectedNote.end=a}}else if(d)c>t.selectedNote.start&&(t.selectedNote.end=c);else if(s){const a=t.getNextDivisionBeat(t.getBeatFromX(e.x));a>t.selectedNote.start&&(t.selectedNote.end=a)}r&&(t.selectedNote.pitch=t.getPitchFromY(e.y)),this._clipEditor.requestUpdate()}onMouseUp(e,t){const s=this._viewModel;t==0&&(this._dragMode=n.none,s.clip&&s.selectedNote&&s.selectedNote.duration<=0&&(s.clip.notes=s.clip.notes.filter(o=>o!==s.selectedNote)),s.selectedNote=null,this._clipEditor.requestUpdate())}onMouseLeave(e,t){this.onMouseUp(e,0)}_addNewNote(e,t){var d;const s=this._viewModel,o=new u.ClipNote(s.getPreviousDivisionBeat(e),s.beatsPerDivision,t,80);s.canAddNote(o)&&((d=s.clip)==null||d.notes.push(o),s.selectedNote=o,this._dragMode=n.noteCreation,this._clipEditor.requestUpdate())}_removeNote(e){const t=this._viewModel;t.clip&&t.canDeleteNote(e)&&(t.clip.notes=t.clip.notes.filter(s=>s!==e),t.selectedNote=null,this._dragMode=n.none,this._clipEditor.requestUpdate())}_beginNoteDrag(e,t){const s=this._viewModel;if(!s.clip)return;const o=e.getPercent(t);s.canEditNotePitch(e)&&(this._dragMode=n.pitch),o<=s.noteResizeHandleArea?s.canEditNoteStart(e)&&(this._dragMode=n.noteStart):o>=1-s.noteResizeHandleArea?s.canEditNoteEnd(e)&&(this._dragMode=n.noteEnd):s.canEditNoteStart(e)&&s.canEditNoteEnd(e)&&(this._dragMode+=n.noteStart+n.noteEnd),this._dragMode==n.noteEnd?this._dragOffset=t-e.end:this._dragOffset=t-e.start,s.selectedNote=e,this._clipEditor.requestUpdate()}}export{B as C,G as a,n as d,$ as e,v as i,U as n,p as t};
